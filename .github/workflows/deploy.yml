name: Deploy to GitHub Pages

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Create gemini-config.js with API Key
        run: |
          echo "ğŸš€ Creating gemini-config.js..."
          
          # Buat folder jika belum ada
          mkdir -p assets/js
          
          # Langsung buat file dengan API Key dari secrets
          # Perhatikan: menggunakan EOF tanpa quote agar variable diganti
          cat > assets/js/gemini-config.js << EOF
          # Gemini API Configuration - Generated $(date)
          const GEMINI_CONFIG = { 
            apiKey: "${{ secrets.GEMINI_API_KEY }}", 
            apiEndpoint: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent',
            systemContext: \`Anda adalah pakar riset pasar dan strategi pemasaran yang mengkhususkan diri pada demografi Anak Muda (Gen Z) di Kota Solo (Surakarta), Indonesia.
            Gunakan data berikut sebagai basis pengetahuan Anda:
            - Profil Psikografis: "The Santuy Hustler", santai tapi produktif, communal oriented (FOMO), smart spender (price sensitive).
            - Media Sosial: TikTok (Search engine), Instagram (Lifestyle/Aesthetic), X/Twitter (Info & Sambat).
            - Topik Viral: Hidden gem kuliner, Campus Life (UNS/UMS), Event/Konser lokal.
            - Perilaku Nongkrong: Cafe adalah kantor kedua. Prioritas utama: WiFi & Colokan. Area favorit: Jebres (UNS) & Pabelan (UMS).
            - Minat Belajar: Digital Marketing, Content Creation, Bahasa Inggris. Hambatan: Biaya mahal (>150rb), Lokasi jauh.
            - Strategi Marketing Efektif: Promo KTM (Mahasiswa), Community Partnership, Visual Aesthetic, Bahasa campuran Indo-Jawa santai.
            Gaya bicara Anda: Profesional namun santai, menggunakan istilah anak muda yang relevan, dan memberikan saran praktis yang bisa langsung diterapkan di Solo.\`,
          
            isValid: function() {
                // Simple validation
                return this.apiKey && this.apiKey.length > 30;
            },
    
            getApiKey: function() {
                if (!this.isValid()) {
                    console.error('âŒ API Key invalid. Check GitHub Secrets.');
                    return null;
                }
                return this.apiKey;
            }
          };
    
          # Debug info
          console.log('ğŸ”§ gemini-config.js loaded');
          console.log('API Key present:', !!GEMINI_CONFIG.apiKey);
          EOF
          
          # Verifikasi
          echo "âœ… File created. Checking..."
          if [ -f "assets/js/gemini-config.js" ]; then
            echo "ğŸ“ File exists. Size: $(wc -c < assets/js/gemini-config.js) bytes"
            echo "ğŸ” First 50 chars:"
            head -c 100 assets/js/gemini-config.js
            echo ""
          else
            echo "âŒ ERROR: File not created"
            exit 1
          fi
          
      - name: Setup Pages
        uses: actions/configure-pages@v3
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: '.'
          
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v2
